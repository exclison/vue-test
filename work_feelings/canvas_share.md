
HTML Canvas 知识分享

    在青岛革命烈士博物馆官网项目中,我们遇到了需要前端知识实现水墨擦出图片内容特效的需求,这是整个项目的一大难点。经过研究与学习,最终得出可使用canvas实现此需求。

    方案如下:主要利用canvas实例的drawImage方法绘制图片到画布中,以及CanvasRenderingContext2D.globalCompositeOperation属性来设置两张图片重叠时的合成类型。

    当globalCompositeOperation属性设置为source-in时,canvas会在仅有两张图片重叠时绘制,其余部分为透明,这就让我们可以用一张图片固定绘制范围,然后动态切换图片以达到显示不同图片的目的。但是每次切换图片重新渲染时,必须重置globalCompositeOperation为source-over,否则画布会变为空白。

    由此我们便解决了绘制最终水墨边缘的图片内嵌效果,但仍然没解决水墨擦出特效,在经过其他一系列的技术实验,我们有了新的思路。

    在使用图片重叠方案以前,曾使用在canvas画布中画多个不断扩散的圆形以代替水墨图片的效果,成果中的动效不错,但是难以还原水墨效果,不过既然多个原型不断扩散可以实现,那么理论上使用多个水墨图片切帧渲染同样可以实现。

    理论上,可使用window.requestAnimationFrame方法实现更新动画,通过按帧不断切换水墨范围的图片来更新绘制图片的范围,直至绘制到最终范围,来实现水墨擦出的动画效果。不过由于最终设计的修改,此部分没有走到实践层面。

    此外,犹豫上面提到图片绘制范围固定,但是图片大小却是动态的,需要对图片尺寸进行裁剪,以达到图片绘制始终绘制图片最中心的内容,此处使用drawImage方法的多参数计算实现。

    drawImage方法有九个参数,分别为:需要绘制的图片,绘制图片开始裁剪的坐标与宽高,在画布中绘制的坐标与宽高。我们可以根据画布的宽高比以及图片的宽高,来计算裁剪区域与绘制区域,最终实现将图片中心部分绘制到画布中。
